<!DOCTYPE html>
<html>

<head>
    <script>
        let connected = false;
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('target').focus();
        });
        
        function tryConnect() {
            console.log('[tlive] - Trying to connect to the server')

            const ws = new WebSocket("ws://{addr}:{port}/listen");
            ws.addEventListener('open', (_) => {
                console.log('[tlive] - Connected to the server')

                connected = true;
            });

            ws.addEventListener('message', (e) => {
                console.log('[tlive] - Updating pdf')

                const pdf = document.getElementById("target")
                if (pdf) {
                    pdf.src += '';
                    pdf.focus();
                }
            });

            ws.addEventListener('close', (_) => {
                console.log('[tlive] - Disconnected')

                connected = false;
            });

            setTimeout(() => {
                if (connected) return;
                tryConnect()
            })
        }

        tryConnect();
        pdf.focus();
    </script>

    <style>
        iframe {
            border: none;
        }
        body {
            display: flex;
            width: 100vw;
            height: 100vh;
            margin: 0;
        }
    </style>
</head>

<body>
    <iframe id="target" src="/target.pdf" type="application/pdf" width="100%" height="100%" />
</body>

</html>
